<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesquisa Funcionario - ExitoTech</title>
    <link rel="shortcut icon" href="img/logo_transparent.png" type="image/x-icon">
    <link rel="stylesheet" href="css/pesquisaFunc.css">
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="shortcut icon" href="./img/logo_transparent.png" type="image/x-icon">
    <script type="text/javascript" src="https://www.chartjs.org/dist/2.8.0/Chart.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
</head>

<body>
    <main>
        <div class="navBar">
            <div class="logoNavBar">
                <img src="./img/logo_transparent.png" alt="" class="logoNavBar">
            </div>
            <div class="navBarContent">
                <div class="fotoPerfil">
                    <img src="./img/fotoPerfil/perfil.png" alt="">
                </div>
                <div class="contentOpcoes">
                    <a href="./home.html">
                        <div class="opcaoNavBar agora">
                            <img src="./img/icons/inicio.png" alt="">
                            <p style="font-weight:500">Início</p>
                        </div>
                    </a>
                    <a href="./dashboard.html">
                        <div class="opcaoNavBar">
                            <img src="./img/icons/dashboard.png" alt="">
                            <p>Dashboard</p>
                        </div>
                    </a>
                    <a href="./setor.html">
                        <div class="opcaoNavBar">
                            <img src="./img/icons/setor.png" alt="">
                            <p>Setor</p>
                        </div>
                    </a>
                    <a href="./visualizacao.html">
                        <div class="opcaoNavBar">
                            <img src="./img/icons/processador.png" alt="">
                            <p>Visualização</p>
                        </div>
                    </a>
                </div>
            </div>
            <div class="opcaoNavBar exit">
                <img src="./img/icons/sair.png" alt="">
                <p>Exit</p>
            </div>
        </div>
        <div class="backTitle">
            <div class="voltar">
                <img src="./img/icons/leftArrow.png" style="height: 15px; margin-right: 2%" alt="">
                <div class="titulo">
                    <p>Buscar Máquina</p>
                </div>
            </div>
            <div class="mainSearchFunc">
                <div class="subMainSearchFunc">
                    <div class="divInputSearch">
                        <div class="submit-line">
                            <input id="numMaquina" type="text" />
                            <button onclick="pesquisarMaquina()" class="submit-lente" type="submit">
                                <i class="fa fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <div class="divMainSearch">
                        <div class="divInfoInputs">
                            <div id="divInfoInpus01">
                                <span>Sistema operacional:<span id="sistemaOperacionalText"
                                        class="infoSpan">...</span></span>
                                <span>Número da maquina:<span id="numeroMaquinaText" class="infoSpan">...</span></span>
                                <span>Arquitetura:<span class="infoSpan" id="arquiteturaSoText">...</span></span>
                            </div>
                            <div id="divInfoInpus02">
                                <span>localização/CEP:<span id="localizacaoText" class="infoSpan">...</span></span>
                                <span>Setor:<span class="infoSpan" id="setorMaquinaText">...</span></span>
                                <span>Horas Trabalhadas neste mês:<span class="infoSpan">...</span></span>
                            </div>
                        </div>
                        <div class="infoSoMachine">
                            <div class="infoSoAlign">
                                <div class="img">
                                    <img src="img/ubuntu-logo.png" alt="">
                                </div>
                                <span class="spanSo">
                                    Logo do Sistema Operacional
                                </span>
                            </div>

                            <span class="spanChartPie">Horas trabalhadas X Pausas</span>
                            <p class="pChartPie">Dado mensal</p>
                            <canvas id="myChart" style="width:100%;max-width:250px"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</body>

</html>
<script>
    function pesquisarMaquina() {
        var numeroMaquinaVar = numMaquina.value;

        if (numeroMaquinaVar == "") {
            alert("Campo de pesquisa vazio..")
        }
        else {
            // Enviando o valor da nova input
            fetch("/pesquisaMaquina/pesquisaMaquina", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    numeroMaquinaServer: numeroMaquinaVar,
                })
            }).then(function (resposta) {

                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    Swal.fire({
                        title: `Pesquisando..`,
                        toast: true,
                        showConfirmButton: false,
                        timer: 1000
                    })
                    resposta.json().then((json) => {

                        console.log(json);
                        console.log(JSON.stringify(json) + 'exibindo json stringfy');


                        if (json.length == 0) {
                            Swal.fire({
                                title: `Nenhuma máquina com está identificação encontrada..`,
                                toast: true,
                                showConfirmButton: false,
                                timer: 1000
                            })
                        }
                        else {
                            sistemaOperacionalText.innerHTML = `${json[0].sistemaOperacional}`
                            numeroMaquinaText.innerHTML = `${json[0].idMaquina}`
                            arquiteturaSoText.innerHTML = `${json[0].arquiteturaSO}`
                            setorMaquinaText.innerHTML = `${json[0].nomeSetor.split('setor')[1]}`
                            localizacaoText.innerHTML = `${json[0].CEP}`
                        }

                    });
                } else {
                    throw ("Houve um erro ao tentar realizar o cadastro!");
                }
            }).catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
            return false;
        }


    }


    var xValues = ["Italy", "France"];
    var yValues = [20, 80];
    var barColors = [
        "#b91d47",
        "#00aba9"
    ];

    new Chart("myChart", {
        type: "doughnut",
        data: {
            datasets: [{
                backgroundColor: barColors,
                data: yValues
            }]
        },
        options: {
            title: {
                display: false,
                text: "World Wide Wine Production 2018"
            }
        }
    });
</script>