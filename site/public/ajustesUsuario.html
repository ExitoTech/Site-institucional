<!DOCTYPE html>
<html lang="PT-BR">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ajustes Usuário - ExitoTech</title>
    <link rel="stylesheet" href="./css/ajustesUsuario.css">
    <script src="js/abrirAjusteUser.js"></script>
    <link rel="shortcut icon" href="img/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body onload="buscarImagem()">
    <div class="content">
        <div class="voltar">
            <img src="./img/icons/leftArrow.png" style="height: 15px; margin-right: 2%" alt="">
            <div class="titulo">
                <p>Nova Foto de Perfil</p>
            </div>
        </div>
    </div>


    <div class="alterarFotoUsuario">
        <img src="" alt="">
        <div id="imgTrocar" class="imgUser">
            <img src="" alt="">
        </div>
        <div onclick="abrirModal()" class="opcaoAlterar">
            <p>Alterar foto de perfil <i style="font-size: 20px;cursor: pointer;" class="fa fa-pencil"
                    aria-hidden="true"></i></p>
        </div>
        <div>
            <input id="idInpuFile" class="inputFile" type="text">
            <button onclick="cadastrarImagem()">enviar</button>
        </div>
    </div>
</body>

</html>

<script>
    function cadastrarImagem() {
        var imagemFuncVar = idInpuFile.value;
        var emailUserVar = sessionStorage.EMAIL_USUARIO;

        if (imagemFuncVar == "") {
            alert("campo de imagem está vazio..")
        }
        else {
            // Enviando o valor da nova input
            fetch("/ajustesUsuario/cadastrarImagem", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    imagemFuncServer: imagemFuncVar,
                    emailServer : emailUserVar
                })
            }).then(function (resposta) {

                console.log("resposta: ", resposta);

                if (resposta.ok) {

                    alert("Imagem cadastrada com sucesso!")

                } else {
                    throw ("Houve um erro ao tentar realizar o cadastro!");
                }
            }).catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
            return false;
        }
    }



    function buscarImagem() {
        // Enviando o valor da nova input
        fetch("/buscarImagem/buscarImagem", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {

                resposta.json().then((json) => {

                    console.log(json);
                    console.log(JSON.stringify(json) + 'exibindo json stringfy');
                    console.log(json[0].fotoPerfil);
                    divImgUser = document.getElementById('imgTrocar')

                    if (json[0].fotoPerfil == null) {
                        divImgUser.innerHTML = `<img src="img/fotoPerfil/default-avatar-profile.jpg" alt="">`

                    }
                    else {
                        divImgUser.innerHTML = `<img src="${json[0].fotoPerfil}" alt="">`
                    }

                });

            } else {
                throw ("Houve um erro ao tentar buscar imagem de perfil");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
        return false;
    }
</script>